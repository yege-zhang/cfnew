# CFnew - ترمینال v2.9.3

**زبان:** [中文](README.md) | [فارسی](فارسی.md)

[Telegram گروه](https://t.me/+ft-zI76oovgwNmRh)

## ویژگی‌های اصلی

- پشتیبانی چند پروتکل: VLESS، Trojan، xhttp، می‌تونید همزمان چند تا رو فعال کنید
- مسیر سفارشی: دیگه از UUID به عنوان مسیر استفاده نمی‌شه، می‌تونید خودتون تنظیم کنید، پشتیبانی از مسیرهای چند سطحی
- تست تاخیر: ابزار تست داخلی، تست تاخیر IP، دریافت خودکار کد فرودگاه
- تبدیل اشتراک: می‌تونید آدرس سرویس تبدیل رو خودتون تنظیم کنید
- مدیریت گرافیکی: با KV ذخیره می‌شه، تغییرات بلافاصله اعمال می‌شه، نیازی به استقرار مجدد نیست
- مدیریت API: از طریق RESTful API می‌تونید IP ترجیحی رو مدیریت کنید
- پشتیبانی چند کلاینت: CLASH، SURGE، SING-BOX، LOON، QUANTUMULT X، V2RAY، Shadowrocket، STASH، NEKORAY، V2RAYNG
- بیدار کردن برنامه: با کلیک روی دکمه خودکار برنامه کلاینت باز می‌شه
- تشخیص خودکار: بر اساس User-Agent خودکار تشخیص می‌ده و قالب مناسب رو برمی‌گردونه
- پشتیبانی چند زبان: پشتیبانی از چینی و فارسی، بر اساس زبان مرورگر خودکار تغییر می‌کنه

## به‌روزرسانی v2.9.3

- ویژگی جدید سفارشی‌سازی DNS و دامنه ECH در رابط گرافیکی
  - می‌تونید آدرس سرور DNS رو خودتون تنظیم کنید (فرمت DoH)
  - می‌تونید دامنه ECH رو خودتون تنظیم کنید
  - پشتیبانی از تغییرات پویا، بعد از ذخیره بلافاصله اعمال می‌شه
  - پارامتر query-server-name به ech-opts در پیکربندی Clash اضافه شد، با v2ray هماهنگ شد

## به‌روزرسانی v2.9

- فیلتر منطقه: می‌تونید نتایج ترجیحی رو بر اساس منطقه فیلتر کنید، پشتیبانی از چند انتخاب
- فیلتر تاخیر: گزینه جدید "فقط نمایش 10 تا سریع‌ترین"
- حالت اضافه/جایگزین: هنگام افزودن نتایج ترجیحی می‌تونید اضافه کنید یا کل لیست رو جایگزین کنید
- بهینه‌سازی نمایش نتایج: نمایش برچسب منطقه، مرتب‌سازی بر اساس تاخیر
- بهینه‌سازی‌های جزئی دیگر

---

### ابزارهای مرتبط

- ابزار ترجیحی: https://github.com/byJoey/yx-tools/releases
- آموزش متنی: https://joeyblog.net/yuanchuang/1146.html
- آموزش ویدیویی Workers: https://www.youtube.com/watch?v=aYzTr8FafN4
- آموزش ویدیویی Pages: https://www.youtube.com/watch?v=JhVxJChDL-E
- آموزش ویدیویی Snippets: https://www.youtube.com/watch?v=xeFeH3Akcu8

### استقرار

اشتراک هر 15 دقیقه یکبار خودکار انتخاب می‌شه

#### پیکربندی پایه
| نام متغیر | مقدار | توضیحات |
| :--- | :--- | :--- |
| `u` | UUID شما | الزامی، برای دسترسی به اشتراک و رابط مدیریت |
| `p` | proxyip | اختیاری، آدرس و پورت ProxyIP سفارشی |
| `s` | آدرس SOCKS5 شما | اختیاری، فرمت: `user:pass@host:port` یا `host:port` |
| `d` | مسیر سفارشی | اختیاری، مثل `/mypath` یا `/path/to/sub`، اگر خالی بذارید از UUID استفاده می‌شه. اگر مسیر با `/` شروع نشه خودکار اضافه می‌شه |
| `wk` | کد منطقه | اختیاری، مثل `SG`، `HK`، `US`، `JP` |

#### پیکربندی پروتکل

| نام متغیر | مقدار | توضیحات |
| :--- | :--- | :--- |
| `ev` | yes/no | اختیاری، فعال‌سازی VLESS (پیش‌فرض فعال) |
| `et` | yes/no | اختیاری، فعال‌سازی Trojan (پیش‌فرض غیرفعال) |
| `ex` | yes/no | اختیاری، فعال‌سازی xhttp (پیش‌فرض غیرفعال) |
| `tp` | رمز عبور سفارشی | اختیاری، رمز عبور Trojan، خالی بذارید از UUID استفاده می‌شه |

#### پیکربندی گرافیکی (توصیه می‌شه)

1. در Workers یک فضای نام KV ایجاد کنید، متغیر محیطی `C` رو متصل کنید
2. بعد از استقرار به `/{UUID شما}` برید تا از رابط گرافیکی استفاده کنید
3. تغییرات بلافاصله اعمال می‌شه، نیازی به استقرار مجدد نیست

#### کنترل پیشرفته
| نام متغیر | مقدار | توضیحات |
| :--- | :--- | :--- |
| `yx` | IP/دامنه ترجیحی سفارشی | اختیاری، پشتیبانی از نامگذاری، فرمت: `1.1.1.1:443#گره هنگ‌کنگ,8.8.8.8:53#Google DNS` |
| `yxURL` | URL منبع IP ترجیحی | اختیاری، اگر خالی بذارید از آدرس پیش‌فرض استفاده می‌شه |
| `scu` | آدرس تبدیل اشتراک | اختیاری، پیش‌فرض: `https://url.v1.mk/sub` |
| `epd` | yes/no | اختیاری، فعال‌سازی دامنه ترجیحی (پیش‌فرض فعال) |
| `epi` | yes/no | اختیاری، فعال‌سازی IP ترجیحی (پیش‌فرض فعال) |
| `egi` | yes/no | اختیاری، فعال‌سازی ترجیح GitHub (پیش‌فرض فعال) |
| `qj` | no | اختیاری، وقتی `no` باشه حالت کاهش سطح فعال می‌شه: CF مستقیم ناموفق → SOCKS5 → fallback |
| `dkby` | yes | اختیاری، وقتی `yes` باشه فقط گره‌های TLS تولید می‌شه |
| `yxby` | yes | اختیاری، وقتی `yes` باشه تمام عملکردهای ترجیحی خاموش می‌شه |
| `rm` | no | اختیاری، وقتی `no` باشه تطبیق هوشمند منطقه خاموش می‌شه |
| `ae` | yes | اختیاری، وقتی `yes` باشه اجازه مدیریت API داده می‌شه (پیش‌فرض خاموش) |

#### تنظیمات KV (توصیه می‌شه)

1. در Cloudflare Workers یک فضای نام KV ایجاد کنید
2. در تنظیمات Workers KV رو متصل کنید، نام متغیر رو `C` بذارید
3. Workers رو دوباره استقرار بدید
4. به `/{UUID شما}` برید تا از رابط گرافیکی استفاده کنید

#### استفاده از API
1. نرم‌افزار ترجیحی: https://github.com/byJoey/yx-tools/releases
2. فعال‌سازی API: به `/{UUID}` یا `/{مسیر سفارشی}` برید، "اجازه مدیریت API" رو پیدا کنید، فعال کنید و ذخیره کنید
3. افزودن IP تک:
```bash
# استفاده از مسیر UUID
curl -X POST "https://your-worker.workers.dev/{UUID}/api/preferred-ips" \
  -H "Content-Type: application/json" \
  -d '{"ip": "1.2.3.4", "port": 443, "name": "گره هنگ‌کنگ"}'

# استفاده از مسیر سفارشی (اگر متغیر d تنظیم شده باشد)
curl -X POST "https://your-worker.workers.dev/{مسیر سفارشی}/api/preferred-ips" \
  -H "Content-Type: application/json" \
  -d '{"ip": "1.2.3.4", "port": 443, "name": "گره هنگ‌کنگ"}'
```
4. افزودن دسته‌ای IP:
```bash
curl -X POST "https://your-worker.workers.dev/{UUID یا مسیر سفارشی}/api/preferred-ips" \
  -H "Content-Type: application/json" \
  -d '[
    {"ip": "1.2.3.4", "port": 443, "name": "گره 1"},
    {"ip": "5.6.7.8", "port": 8443, "name": "گره 2"}
  ]'
```
5. پاک کردن همه IP:
```bash
curl -X DELETE "https://your-worker.workers.dev/{UUID یا مسیر سفارشی}/api/preferred-ips" \
  -H "Content-Type: application/json" \
  -d '{"all": true}'
```

### توضیحات عملکرد

#### تست تاخیر

از v2.7 شروع شد، v2.9 فیلتر رو تقویت کرد

- ابزار تست داخلی، نیازی به نصب نرم‌افزار دیگه نیست، مستقیماً در صفحه پیکربندی تست تاخیر IP
- منابع IP:
  - ورودی دستی: مستقیماً IP یا دامنه وارد کنید، پشتیبانی از دسته‌ای (با کاما جدا کنید)
  - IP تصادفی CF: از محدوده IP Cloudflare به صورت تصادفی تولید می‌شه
  - دریافت از URL: از URL راه‌دور لیست IP رو دریافت می‌کنه
- پشتیبانی از تست همزمان 1-50 رشته، پیش‌فرض 5 رشته
- دریافت خودکار کد فرودگاه (مثل SJC، LAX)
- نگاشت خودکار نام فرودگاه چینی (SJC→سن‌خوزه)
- کسر خودکار زمان DNS+TLS، نمایش تاخیر واقعی
- تنظیمات خودکار در مرورگر ذخیره می‌شه
- پشتیبانی از فیلتر بر اساس منطقه
- پشتیبانی از نمایش فقط 10 تا سریع‌ترین
- پشتیبانی از حالت اضافه یا جایگزین

#### پشتیبانی چند پروتکل

- VLESS: پیش‌فرض فعال
- Trojan: پشتیبانی از Trojan-WS-TLS، می‌تونید رمز عبور سفارشی بذارید، خالی بذارید از UUID استفاده می‌شه
- xhttp: پروتکل استتار مبتنی بر HTTP POST
- می‌تونید همزمان چند پروتکل رو فعال کنید، کلاینت خودکار تشخیص می‌ده
- در رابط گرافیکی می‌تونید با یک کلیک فعال/غیرفعال کنید
- دکمه ذخیره مستقل برای پیکربندی پروتکل

#### مسیر سفارشی (متغیر d)

- دیگه از UUID به عنوان مسیر استفاده نمی‌شه، می‌تونید خودتون تنظیم کنید
- پشتیبانی از مسیرهای چند سطحی، مثل `/path/to/sub`
- اگر مسیر با `/` شروع نشه خودکار اضافه می‌شه
- بعد از مسیر سفارشی مسیر UUID خودکار غیرفعال می‌شه
- می‌تونید هر زمان از رابط گرافیکی مسیر رو تغییر بدید

#### مدیریت پیکربندی گرافیکی

- از Cloudflare KV برای ذخیره پیکربندی استفاده می‌شه
- به `/{UUID شما}` یا `/{مسیر سفارشی}` برید تا از رابط استفاده کنید
- تغییرات بلافاصله اعمال می‌شه، نیازی به استقرار مجدد نیست
- اولویت: پیکربندی KV > متغیر محیطی > مقدار پیش‌فرض

#### پشتیبانی چند زبان

- بر اساس زبان مرورگر خودکار چینی یا فارسی رو انتخاب می‌کنه
- در گوشه بالا راست می‌تونید دستی تغییر بدید
- انتخاب زبان در مرورگر ذخیره می‌شه
- نسخه فارسی خودکار RTL رو فعال می‌کنه

#### کنترل تبدیل اشتراک

- می‌تونید آدرس سرویس تبدیل رو خودتون تنظیم کنید
- می‌تونید دامنه ترجیحی، IP ترجیحی، ترجیح GitHub رو جداگانه کنترل کنید
- پیش‌فرض همه فعال هستند
- تغییرات بلافاصله اعمال می‌شه

#### مدیریت API

- از طریق RESTful API می‌تونید IP ترجیحی رو مدیریت کنید، نیازی به تغییر کد نیست
- پشتیبانی از افزودن دسته‌ای
- پشتیبانی از پاک کردن همه IP
- پیش‌فرض خاموشه، باید در رابط گرافیکی فعال کنید
- IP های اضافه شده از طریق API با متغیر yx خودکار ادغام می‌شه
- API endpoints:
  - `GET /{UUID یا مسیر}/api/preferred-ips` - پرس‌وجوی لیست
  - `POST /{UUID یا مسیر}/api/preferred-ips` - افزودن (تک/دسته‌ای)
  - `DELETE /{UUID یا مسیر}/api/preferred-ips` - حذف (تک/همه)

#### تعیین دستی منطقه

- می‌تونید دستی منطقه Worker رو تنظیم کنید، تشخیص خودکار رو بازنویسی می‌کنه
- تنظیم: `wk=SG` یا از رابط گرافیکی
- پشتیبانی از: US، SG، JP، HK، KR، DE، SE، NL، FI، GB

#### نامگذاری گره ترجیحی

- می‌تونید نام سفارشی بذارید، فرمت: `IP:پورت#نام گره`
- مثال: `1.1.1.1:443#گره هنگ‌کنگ,8.8.8.8:53#Google DNS`
- اگر نام نذارید خودکار `ترجیح سفارشی-IP:پورت` تولید می‌شه

#### وضعیت سیستم

- نمایش منطقه Worker، روش تشخیص، وضعیت ProxyIP
- منطق انتخاب: هم‌منطقه → منطقه مجاور → سایر مناطق

#### کنترل پیشرفته

- `rm=no` خاموش کردن تطبیق هوشمند منطقه
- `qj=no` فعال‌سازی حالت کاهش سطح (CF مستقیم ناموفق → SOCKS5 → fallback)
- `dkby=yes` فقط تولید گره‌های TLS
- `yxby=yes` خاموش کردن تمام عملکردهای ترجیحی

#### پشتیبانی چند کلاینت

پشتیبانی از 10 کلاینت: CLASH، SURGE، SING-BOX، LOON، QUANTUMULT X، V2RAY، Shadowrocket، STASH، NEKORAY، V2RAYNG

- بر اساس نوع کلاینت خودکار پیکربندی تولید می‌شه
- در رابط گرافیکی می‌تونید یک کلیکی لینک اشتراک بگیرید
- با کلیک روی دکمه خودکار برنامه کلاینت باز می‌شه
- بر اساس User-Agent خودکار تشخیص می‌ده
- کلاینت‌های مختلف خودکار با بهترین ترکیب پروتکل سازگار می‌شه
- تمام لینک‌های TLS خودکار شامل `h3,h2,http/1.1` می‌شه

#### بهینه‌سازی عملکرد

- هر 15 دقیقه یکبار خودکار انتخاب می‌شه
- چندین طرح پشتیبان
- کش هوشمند، کاهش محاسبات تکراری

### تشکر

- بر اساس [zizifn/edgetunnel](https://github.com/zizifn/edgetunnel) اصلاح شده
- ProxyIP از [cmliu](https://github.com/cmliu)
- IP پروکسی معکوس از [qwer-search](https://github.com/qwer-search)
- رابط ترجیح آنلاین از [白嫖哥](https://t.me/bestcfipas)
## تاریخچه ستاره

[![Star History Chart](https://api.star-history.com/svg?repos=byJoey/cfnew&type=Timeline)](https://www.star-history.com/#byJoey/cfnew&Timeline&LogScale)


